@model UniversityManagement.ViewModels.BulkEnrollmentViewModel

@{
    ViewData["Title"] = "Запиши студенти";
}

<div class="container mt-4">
    <h2>Запиши студенти на предмет: @Model.CourseTitle</h2>

    <!-- Filter Form -->
    <div class="card mb-3">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Филтрирај студенти</h5>
        </div>
        <div class="card-body">
            <form method="get" asp-action="EnrollStudents" id="filterForm">
                <input type="hidden" name="id" value="@Model.CourseId" />
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Семестар</label>
                            <select name="filterSemester" class="form-control" onchange="document.getElementById('filterForm').submit()">
                                <option value="">-- Сите семестри --</option>
                                @for (int i = 1; i <= 8; i++)
                                {
                                    <option value="@i" selected="@(Model.FilterSemester == i)">@i семестар</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Ниво на образование</label>
                            <select name="filterEducationLevel" class="form-control" onchange="document.getElementById('filterForm').submit()">
                                <option value="">-- Сите нивоа --</option>
                                <option value="Додипломски" selected="@(Model.FilterEducationLevel == "Додипломски")">Додипломски</option>
                                <option value="Постдипломски" selected="@(Model.FilterEducationLevel == "Постдипломски")">Постдипломски</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>&nbsp;</label><br />
                            <a asp-action="EnrollStudents" asp-route-id="@Model.CourseId" class="btn btn-secondary">
                                Ресетирај филтри
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <form method="post" asp-action="EnrollStudents">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="CourseId" />

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Year">Година</label>
                    <input type="number" class="form-control" asp-for="Year" min="2020" max="2030" required />
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Semester">Семестар</label>
                    <select class="form-control" asp-for="Semester" required>
                        <option value="">-- Избери семестар --</option>
                        <option value="Зимски">Зимски</option>
                        <option value="Летен">Летен</option>
                    </select>
                </div>
            </div>
        </div>

        <h4>Избери студенти: (@Model.AvailableStudents.Count пронајдени)</h4>
        <div class="card">
            <div class="card-body" style="max-height: 400px; overflow-y: scroll;">
                @if (Model.AvailableStudents.Any())
                {
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onclick="toggleAll(this)" />
                                </th>
                                <th>Индекс</th>
                                <th>Име и презиме</th>
                                <th>Семестар</th>
                                <th>Ниво</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.AvailableStudents.Count; i++)
                            {
                                <tr>
                                    <td>
                                        <input type="checkbox"
                                               name="SelectedStudentIds"
                                               value="@Model.AvailableStudents[i].Id"
                                               class="student-checkbox" />
                                    </td>
                                    <td>@Model.AvailableStudents[i].StudentId</td>
                                    <td>@Model.AvailableStudents[i].FullName</td>
                                    <td>@Model.AvailableStudents[i].CurrentSemester</td>
                                    <td>@Model.AvailableStudents[i].EducationLevel</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Сите студенти се веќе запишани на овој предмет.</p>
                }
            </div>
        </div>

        <div class="mt-3">
            <button type="submit" class="btn btn-primary" @(Model.AvailableStudents.Any() ? "" : "disabled")>
                Запиши избрани студенти
            </button>
            <a asp-action="ManageEnrollments" asp-route-id="@Model.CourseId" class="btn btn-secondary">
                Прегледај запишани
            </a>
            <a asp-action="Courses" class="btn btn-outline-secondary">Назад</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function toggleAll(source) {
            var checkboxes = document.querySelectorAll('.student-checkbox');
            for (var i = 0; i < checkboxes.length; i++) {
                checkboxes[i].checked = source.checked;
            }
        }
    </script>
}
